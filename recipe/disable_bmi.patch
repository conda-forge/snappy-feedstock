From a3a3d52311e827c248f192267a80b22d65065f20 Mon Sep 17 00:00:00 2001
From: "Uwe L. Korn" <xhochy@users.noreply.github.com>
Date: Thu, 25 Jun 2020 20:00:03 +0200
Subject: [PATCH] Disable BMI usage

---
 snappy.cc | 5 +----
 1 file changed, 1 insertion(+), 4 deletions(-)

diff --git a/snappy.cc b/snappy.cc
index 790ae7e..f73f3f3 100644
--- a/snappy.cc
+++ b/snappy.cc
@@ -746,14 +746,11 @@ static inline void Report(const char *algorithm, size_t compressed_size,
 static inline uint32_t ExtractLowBytes(uint32_t v, int n) {
   assert(n >= 0);
   assert(n <= 4);
-#if SNAPPY_HAVE_BMI2
-  return _bzhi_u32(v, 8 * n);
-#else
+
   // This needs to be wider than uint32_t otherwise `mask << 32` will be
   // undefined.
   uint64_t mask = 0xffffffff;
   return v & ~(mask << (8 * n));
-#endif
 }
 
 static inline bool LeftShiftOverflows(uint8_t value, uint32_t shift) {
